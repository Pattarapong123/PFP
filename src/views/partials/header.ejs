<header class="navbar" role="banner">
  <style>
    .site-header {
      display:flex; align-items:center; justify-content:space-between;
      min-height:64px; padding-block:8px; gap:20px;
    }
    .brand{ display:flex; align-items:center; gap:10px; text-decoration:none; }
    .brand-logo{ width:44px; height:44px; object-fit:cover; border-radius:8px; }
    .nav-left{ display:flex; align-items:center; gap:24px; }

    .main-nav{ display:flex; align-items:center; gap:18px; }
    .main-nav a{
      text-decoration:none; padding:8px 10px; border-radius:8px; font-weight:600;
      color: var(--muted);                    /* ‚úÖ ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö dark/light */
      transition: background .2s ease, color .2s ease;
    }
    .main-nav a:hover{ color: var(--text); background: color-mix(in oklab, var(--primary) 10%, transparent); }
    .main-nav a.active{
      background: color-mix(in oklab, var(--primary) 14%, transparent);
      color: var(--primary);
    }

    .header-actions{ display:flex; align-items:center; gap:12px; margin-left:auto; }
    .cart-link{ text-decoration:none; padding:6px 12px; border-radius:20px; background: rgba(0,0,0,.05); }
    .cart-badge{ background:#ff3b30; color:#fff; border-radius:999px; padding:2px 6px; font-size:12px; margin-left:4px; }

    /* Theme toggle button */
    .theme-toggle{
      display:inline-flex; align-items:center; justify-content:center;
      height:36px; min-width:36px; padding:0 10px; border-radius:10px;
      border:1px solid var(--border); background:var(--panel); color:inherit;
      font-weight:800; cursor:pointer; transition:.2s;
      order:99;
    }
    .theme-toggle:hover{ background: rgba(11,99,246,.06); border-color: rgba(11,99,246,.35); }
    .theme-toggle:active{ transform: translateY(1px); }
    .theme-toggle .icon{ font-size:16px; line-height:1; }

    /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ñ‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡πÇ‡∏õ‡∏£‡πà‡∏á‡∏ô‡∏¥‡∏î ‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ò‡∏µ‡∏° */
    .navbar{
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--border);
    }
    :root[data-theme="dark"] .navbar{ background: rgba(21,25,34,.7); }
  </style>

  <div class="container site-header">
    <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ + ‡πÄ‡∏°‡∏ô‡∏π -->
    <div class="nav-left">
      <a class="brand" href="/" aria-label="‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å PFP">
        <img src="/images/logo2.jpg" class="brand-logo" alt="PFP Logo">
      </a>
      <nav class="main-nav" role="navigation" aria-label="‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å">
        <a href="/" class="<%= path==='/' ? 'active' : '' %>">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
        <a href="/products" class="<%= (path||'').startsWith('/products') ? 'active' : '' %>">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
        <a href="/portfolio" class="<%= (path||'').startsWith('/portfolio') ? 'active' : '' %>">‡∏ú‡∏•‡∏á‡∏≤‡∏ô</a>
        <a href="/about" class="<%= path==='/about' ? 'active' : '' %>">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a>
        <a href="/contact" class="<%= path==='/contact' ? 'active' : '' %>">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a>
      </nav>
    </div>

    <!-- ‡∏Ç‡∏ß‡∏≤: ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ + ‡∏™‡∏•‡∏±‡∏ö‡∏ò‡∏µ‡∏° -->
    <div class="header-actions">
      <% if (user) { %>
        <span>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <%= user.name || user.email %></span>
        <a href="/orders/mine" class="<%= (path||'').startsWith('/orders') ? 'active' : '' %>">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a>
        <form method="post" action="/auth/logout" style="margin:0;">
          <button class="btn btn--outline btn--sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </form>
      <% } else { %>
        <a href="/auth/login" class="<%= (path||'').startsWith('/auth/login') ? 'active' : '' %>">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>
      <% } %>

      <a href="/cart"
         class="cart-link <%= (path||'').startsWith('/cart') || (path||'').startsWith('/checkout') ? 'active' : '' %>">
        ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ <span class="cart-badge" id="cartCount"><%= cartCount %></span>
      </a>

      <button id="themeToggle" class="theme-toggle" type="button" aria-label="Toggle theme">
        <span class="icon" id="themeIcon">üåô</span>
      </button>
    </div>
  </div>

  <!-- Theme toggle logic -->
  <script>
    (function(){
      const THEME_KEY = 'pfp.theme';
      const html = document.documentElement;
      const btn  = document.getElementById('themeToggle');
      const icon = document.getElementById('themeIcon');

      function syncIcon(){
        const isDark = html.getAttribute('data-theme') === 'dark';
        icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        btn.setAttribute('aria-pressed', String(isDark));
      }
      (function init(){
        const saved = localStorage.getItem(THEME_KEY);
        if (saved === 'light' || saved === 'dark') {
          html.setAttribute('data-theme', saved);
        } else {
          const prefersDark = window.matchMedia?.('(prefers-color-scheme: dark)').matches;
          html.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        }
        syncIcon();
      })();
      btn.addEventListener('click', () => {
        const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem(THEME_KEY, next);
        syncIcon();
      });
    })();
  </script>
</header>
